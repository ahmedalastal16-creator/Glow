<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <base target="_self">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Glow AI | Ù…Ø³Ø§Ø¹Ø¯ ØªØ¹Ù„ÙŠÙ…ÙŠ Ø°ÙƒÙŠ</title>
    <meta name="description" content="Ù…Ø³Ø§Ø¹Ø¯ ØªØ¹Ù„ÙŠÙ…ÙŠ Ø°ÙƒÙŠ Ù„Ù„Ù…Ø³Ø§Ø¹Ø¯Ø© ÙÙŠ ÙÙ‡Ù… Ø§Ù„Ù…ÙˆØ§Ø¯ Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠØ© ÙˆØªØ­Ù„ÙŠÙ„ Ø§Ù„Ù…Ù„ÙØ§Øª Ø§Ù„ØªØ¹Ù„ÙŠÙ…ÙŠØ©">
    <meta name="theme-color" content="#050505">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Glow-Ai">
    <link rel="manifest" href="manifest.json">
    <link rel="apple-touch-icon" href="192.png">
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.16.105/pdf.min.js"></script>
    <!-- Google Identity Services -->
    <script src="https://accounts.google.com/gsi/client" async defer></script>
    <style>
        :root {
    --primary: #D4AF37; /* Ø°Ù‡Ø¨ÙŠ Ø£Ø³Ø§Ø³ÙŠ */
    --secondary: #F3E5AB; /* Ø°Ù‡Ø¨ÙŠ ÙØ§ØªØ­ */
    --bg: #050505;
    --card: #121212;
    --text: #ffffff;
    --input-bg: #151515;
    --border: #333;
    --success: #D4AF37;
    --warning: #ffaa00;
    --error: #ff4444;
    --gradient-primary: linear-gradient(90deg, #D4AF37, #F3E5AB);
    
    /* Ø£Ù„ÙˆØ§Ù† Ø¬ÙˆØ¬Ù„ Ø®Ù„ÙŠÙ‡Ù… Ø²ÙŠ Ù…Ø§ Ù‡Ù… */
    --google-blue: #4285F4;
    --google-red: #EA4335;
    --google-green: #34A853;
    --google-yellow: #FBBC05;
}
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Tajawal', sans-serif;
        }
        
        *:focus, *:active {
            outline: none !important;
            -webkit-tap-highlight-color: transparent;
        }
        
        body {
            background: var(--bg);
            color: var(--text);
            height: 100vh;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            position: relative;
        }
        
        /* ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ù…Ø¹ Google */
        #auth-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(5, 5, 5, 0.98);
            z-index: 2000;
            display: flex;
            justify-content: center;
            align-items: center;
            backdrop-filter: blur(15px);
        }
        
        .auth-container {
    background: linear-gradient(145deg, #0a0a0a, #000);
    padding: 50px 40px;
    border-radius: 30px;
    border: 2px solid var(--primary);
    max-width: 800px;  /* Ø²ÙˆØ¯ØªÙ‡Ø§ Ù…Ù† 500 Ù„Ù€ 800px */
    width: 95%;  /* Ø®Ù„ÙŠØªÙ‡Ø§ 95% Ø¹Ø´Ø§Ù† ØªØ§Ø®Ø¯ Ù…Ø³Ø§Ø­Ø© Ø£ÙƒØ¨Ø± */
}
        
        @keyframes slideUp {
            from { transform: translateY(30px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        
        .auth-title {
            color: var(--primary);
            font-size: 2.5rem;
            margin-bottom: 10px;
            font-weight: 800;
            background: var(--gradient-primary);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .auth-subtitle {
            color: #aaa;
            margin-bottom: 40px;
            font-size: 1.1rem;
            line-height: 1.6;
        }
        
        .auth-features {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-bottom: 40px;
            text-align: right;
        }
        
        .feature-item {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 12px 20px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: 0.3s;
        }
        
        .feature-item:hover {
            background: rgba(0, 255, 136, 0.1);
            border-color: var(--primary);
            transform: translateX(-5px);
        }
        
        .feature-icon {
            color: var(--primary);
            font-size: 1.3rem;
            width: 40px;
            height: 40px;
            background: rgba(0, 255, 136, 0.1);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .feature-text {
            flex: 1;
            text-align: right;
        }
        
        .feature-text h4 {
            color: var(--primary);
            margin-bottom: 5px;
            font-size: 1rem;
        }
        
        .feature-text p {
            color: #999;
            font-size: 0.9rem;
        }
        
        /* Ø²Ø± Google */
        .google-btn {
            width: 100%;
            padding: 16px;
            background: white;
            border: none;
            border-radius: 12px;
            color: #444;
            font-weight: 700;
            font-size: 1.1rem;
            cursor: pointer;
            transition: 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            margin-bottom: 20px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }
        
        .google-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
        }
        
        .google-btn:active {
            transform: translateY(-1px);
        }
        
        .google-icon {
            width: 24px;
            height: 24px;
            background: url('data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTgiIGhlaWdodD0iMTgiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PGcgZmlsbD0ibm9uZSIgZmlsbC1ydWxlPSJldmVub2RkIj48cGF0aCBkPSJNMTcuNiA5LjJsLS4xLTEuOEg5djMuNGg0LjhDMTMuNiAxMiAxMyAxMyAxMiAxMy42djIuMmgzYTguOCA4LjggMCAwIDAgMi42LTYuNnoiIGZpbGw9IiM0Mjg1RjQiIGZpbGwtcnVsZT0ibm9uemVybyIvPjxwYXRoIGQ9Ik05IDE4YzIuNCAwIDQuNS0uOCA2LTIuMmwtMy0yLjJhNS40IDUuNCAwIDAgMS04LTIuOUgxVjEzYTkgOSAwIDAgMCA4IDV6IiBmaWxsPSIjMzRBODUzIiBmaWxsLXJ1bGU9Im5vbnplcm8iLz48cGF0aCBkPSJNNCAxMC43YTUuNCA1LjQgMCAwIDEgMC0zLjRWNUgxYTkgOSAwIDAgMCAwIDhsMy0yLjN6IiBmaWxsPSIjRkJCQzA1IiBmaWxsLXJ1bGU9Im5vbnplcm8iLz48cGF0aCBkPSJNOSAzLjZjMS4zIDAgMi41LjQgMy40IDEuM0wxNSAyLjNBOSA5IDAgMCAwIDEgNWwzIDIuNGE1LjQgNS40IDAgMCAxIDUtMy43eiIgZmlsbD0iI0VBNDMzNSIgZmlsbC1ydWxlPSJub256ZXJvIi8+PC9nPjwvc3ZnPg==') no-repeat center;
            background-size: contain;
        }
        
        .auth-footer {
            margin-top: 25px;
            color: #666;
            font-size: 0.9rem;
            line-height: 1.6;
        }
        
        .auth-footer a {
            color: var(--primary);
            text-decoration: none;
            font-weight: 700;
        }
        
        /* Ø§Ù„Ù‡ÙŠØ¯Ø± */
        header {
            padding: 15px 5%;
            background: #0a0a0a;
            border-bottom: 1px solid var(--border);
            display: flex;
            justify-content: space-between;
            align-items: center;
            z-index: 10;
            flex-shrink: 0;
        }
        
        .logo-area {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .menu-toggle {
            font-size: 1.5rem;
            color: var(--primary);
            cursor: pointer;
            padding: 5px;
            transition: 0.3s;
        }
        
        .menu-toggle:hover {
            transform: scale(1.1);
        }
        
        .logo {
            font-size: 1.8rem;
            font-weight: 800;
            color: var(--primary);
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .logo span {
            color: #666;
            font-weight: 400;
        }
        
        .user-area {
            display: flex;
            align-items: center;
            gap: 20px;
        }
        
        /* ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ù†Ø³Ø¯Ù„Ø© Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù… */
        .user-profile {
            position: relative;
            display: flex;
            align-items: center;
            gap: 12px;
            cursor: pointer;
            padding: 8px 15px;
            border-radius: 25px;
            background: rgba(255, 255, 255, 0.05);
            transition: 0.3s;
        }
        
        .user-profile:hover {
            background: rgba(0, 255, 136, 0.1);
        }
        
        .user-avatar {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            object-fit: cover;
            border: 2px solid var(--primary);
        }
        
        .user-name {
            font-weight: 700;
            color: var(--primary);
            font-size: 0.95rem;
        }
        
        /* Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ù†Ø³Ø¯Ù„Ø© Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù… ÙÙŠ Ø§Ù„Ø²Ø§ÙˆÙŠØ© Ø§Ù„Ø³ÙÙ„ÙŠØ© Ø§Ù„ÙŠØ³Ø±Ù‰ */
        .user-dropdown {
            position: fixed;
            bottom: 80px;
            left: 20px;
            width: 250px;
            background: #1a1a1a;
            border-radius: 20px;
            border: 2px solid var(--primary);
            z-index: 1500;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5);
            display: none;
            overflow: hidden;
            animation: slideUpDropdown 0.3s ease;
        }
        
        @keyframes slideUpDropdown {
            from { transform: translateY(20px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        
        .dropdown-header {
            padding: 20px;
            background: rgba(0, 255, 136, 0.1);
            border-bottom: 1px solid var(--primary);
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .dropdown-avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            object-fit: cover;
            border: 3px solid var(--primary);
        }
        
        .dropdown-user-info {
            flex: 1;
        }
        
        .dropdown-user-name {
            color: var(--primary);
            font-weight: 800;
            font-size: 1.1rem;
            margin-bottom: 5px;
        }
        
        .dropdown-user-email {
            color: #aaa;
            font-size: 0.85rem;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }
        
        .dropdown-body {
            padding: 15px 0;
        }
        
        .dropdown-item {
            padding: 15px 20px;
            display: flex;
            align-items: center;
            gap: 12px;
            cursor: pointer;
            transition: 0.3s;
            color: #ddd;
        }
        
        .dropdown-item:hover {
            background: rgba(0, 255, 136, 0.1);
            color: var(--primary);
        }
        
        .dropdown-item i {
            width: 20px;
            text-align: center;
        }
        
        .logout-btn {
            border-top: 1px solid #333;
            margin-top: 10px;
            padding-top: 10px;
        }
        
        .plus-btn {
            background: var(--gradient-primary);
            color: #000;
            padding: 8px 20px;
            border-radius: 50px;
            font-weight: 800;
            border: none;
            cursor: pointer;
            transition: 0.3s;
        }
        
        .plus-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 255, 136, 0.3);
        }
        
        .admin-status {
            color: var(--primary);
            font-weight: 800;
            border: 1px solid var(--primary);
            padding: 5px 15px;
            border-radius: 50px;
            font-size: 0.9rem;
            display: none;
        }
        
        /* Ø§Ù„Ø´Ø±ÙŠØ· Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠ */
        #sidebar {
            position: fixed;
            right: -320px;
            top: 0;
            width: 320px;
            height: 100%;
            background: #0a0a0a;
            border-left: 1px solid var(--border);
            z-index: 1000;
            transition: 0.4s ease;
            display: flex;
            flex-direction: column;
            padding: 20px;
            box-shadow: -5px 0 30px rgba(0, 0, 0, 0.5);
        }
        
        #sidebar.open {
            right: 0;
        }
        
        .sidebar-header {
            border-bottom: 1px solid var(--border);
            padding-bottom: 15px;
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .sidebar-header h3 {
            color: var(--primary);
            font-size: 1.3rem;
        }
        
        .sidebar-close {
            color: #666;
            font-size: 1.3rem;
            cursor: pointer;
            padding: 5px;
            transition: 0.3s;
        }
        
        .sidebar-close:hover {
            color: var(--primary);
            transform: rotate(90deg);
        }
        
        .sidebar-btn {
            padding: 14px;
            border-radius: 12px;
            cursor: pointer;
            margin-bottom: 12px;
            text-align: center;
            font-weight: bold;
            font-size: 0.95rem;
            transition: 0.3s;
            display: block;
            text-decoration: none;
        }
        
        .new-chat-btn {
            background: #1a1a1a;
            border: 2px dashed var(--primary);
            color: var(--primary);
        }
        
        .new-chat-btn:hover {
            background: rgba(0, 255, 136, 0.1);
            border-style: solid;
        }
        
        .moe-btn {
            background: var(--gradient-primary);
            color: #000;
            border: none;
        }
        
        .moe-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 255, 136, 0.3);
        }
        
        .history-list {
            flex: 1;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-top: 10px;
            padding-right: 5px;
        }
        
        .history-item {
            background: #151515;
            padding: 14px;
            border-radius: 10px;
            cursor: pointer;
            font-size: 0.9rem;
            border: 1px solid transparent;
            transition: 0.2s;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .history-item:hover {
            border-color: var(--primary);
            background: #1a1a1a;
        }
        
        .history-item.active {
            border-color: var(--primary);
            background: rgba(0, 255, 136, 0.1);
        }
        
       /* Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ø¯Ø±Ø¯Ø´Ø© */
#chat-box {
    flex: 1;
    padding: 25px 8%; /* Ø²ÙˆØ¯ Ø§Ù„Ù…Ø³Ø§ÙØ© Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠØ© Ø´ÙˆÙŠ */
    overflow-y: auto;
    display: flex;
    flex-direction: column;
    gap: 20px;
    width: 100%;
    max-width: 1400px; /* Ø²ÙˆØ¯ Ù…Ù† 1200 Ù„Ù€ 1400px */
    margin: 0 auto;
}
        
        .msg-wrapper {
            display: flex;
            align-items: flex-start;
            gap: 15px;
            max-width: 100%;
        }
        
        .ai-wrapper {
            align-self: flex-start;
        }
        
        .user-wrapper {
            align-self: flex-end;
            flex-direction: row-reverse;
        }
        
        .ai-icon {
            width: 42px;
            height: 42px;
            background: #1a1a1a;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--primary);
            border: 2px solid #333;
            flex-shrink: 0;
            font-size: 1.1rem;
        }
        
        .msg {
    line-height: 1.6;
    font-size: 1.05rem; /* ÙƒØ¨Ø± Ø§Ù„Ø®Ø· Ø´ÙˆÙŠ */
    position: relative;
    padding: 20px 24px; /* Ø²ÙˆØ¯ Ø§Ù„Ù…Ø³Ø§ÙØ© Ø§Ù„Ø¯Ø§Ø®Ù„ÙŠØ© */
    border-radius: 22px; /* Ø²ÙˆØ¯ Ø§Ù„ØªØ¯ÙˆÙŠØ± */
    max-width: 90%; /* Ø²ÙˆØ¯ Ù…Ù† 85% Ù„Ù€ 90% */
    word-wrap: break-word;
}
        
        .msg.ai {
            background: #1a1a1a;
            border: 1px solid #333;
            white-space: pre-wrap;
            border-top-right-radius: 4px;
        }
        
        .msg.user {
            background: var(--primary);
            color: #000;
            font-weight: 700;
            border-top-left-radius: 4px;
            max-width: fit-content;
            padding: 12px 20px;
        }
        
     /* Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„ */
.input-area {
    padding: 20px 8% 30px; /* Ù†ÙØ³ Ù†Ø³Ø¨Ø© Ø§Ù„Ù€ chat-box */
    background: #0a0a0a;
    border-top: 1px solid var(--border);
    position: relative;
    flex-shrink: 0;
    width: 100%;
    max-width: 1400px; /* Ù†ÙØ³ Ø§Ù„Ù€ max-width */
    margin: 0 auto;
}
        
        .web-search-toggle {
            display: flex;
            align-items: center;
            gap: 8px;
            background: #111;
            border: 1px solid #333;
            padding: 8px 20px;
            border-radius: 25px;
            cursor: pointer;
            margin: 0 auto 20px;
            width: fit-content;
            transition: 0.3s;
            font-size: 0.85rem;
            color: #666;
        }
        
        .web-search-toggle.active {
            border-color: var(--primary);
            color: var(--primary);
            box-shadow: 0 0 15px rgba(0, 255, 136, 0.3);
            background: rgba(0, 255, 136, 0.1);
        }
        
      .input-container {
    background: var(--input-bg);
    border: 2px solid #333;
    border-radius: 40px; /* Ø²ÙˆØ¯ Ø§Ù„ØªØ¯ÙˆÙŠØ± */
    display: flex;
    align-items: flex-end;
    padding: 18px 22px; /* Ø²ÙˆØ¯ Ø§Ù„Ù…Ø³Ø§ÙØ© Ø§Ù„Ø¯Ø§Ø®Ù„ÙŠØ© */
    width: 100%;
    margin: 0 auto;
    gap: 15px; /* Ø²ÙˆØ¯ Ø§Ù„Ù…Ø³Ø§ÙØ© Ø¨ÙŠÙ† Ø§Ù„Ø¹Ù†Ø§ØµØ± */
    transition: 0.3s;
}

.input-container textarea {
    flex: 1;
    background: transparent;
    border: none;
    color: white;
    padding: 12px 15px; /* Ø²ÙˆØ¯ Ø§Ù„Ù…Ø³Ø§ÙØ© Ø§Ù„Ø¯Ø§Ø®Ù„ÙŠØ© */
    outline: none;
    font-size: 1.1rem; /* ÙƒØ¨Ø± Ø§Ù„Ø®Ø· */
    resize: none;
    max-height: 250px; /* Ø²ÙˆØ¯ Ø§Ù„Ø§Ø±ØªÙØ§Ø¹ Ø§Ù„Ø£Ù‚ØµÙ‰ */
    min-height: 30px;
    line-height: 1.6;
    font-family: 'Tajawal', sans-serif;
}
        
        .input-actions {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .action-icon {
            color: var(--primary);
            font-size: 1.4rem;
            cursor: pointer;
            padding: 8px;
            display: inline-block;
            transition: 0.3s;
            border-radius: 50%;
        }
        
        .action-icon:hover {
            background: rgba(0, 255, 136, 0.1);
            transform: scale(1.1);
        }
        
      .send-btn-small {
    background: var(--gradient-primary);
    color: #000;
    border: none;
    width: 55px; /* ÙƒØ¨Ø± Ù…Ù† 48 Ù„Ù€ 55px */
    height: 55px; /* ÙƒØ¨Ø± Ù…Ù† 48 Ù„Ù€ 55px */
    border-radius: 50%;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: 0.3s;
    flex-shrink: 0;
    font-size: 1.3rem; /* ÙƒØ¨Ø± Ø§Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø© */
}
        
        .send-btn-small:hover {
            transform: translateY(-2px) scale(1.05);
            box-shadow: 0 5px 20px rgba(0, 255, 136, 0.4);
        }
        
        .send-btn-small.stop {
            background: var(--error);
            animation: pulse 1.5s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }
        
        /* Ù…Ø¹Ù„ÙˆÙ…Ø§Øª PDF */
        #pdf-info {
            text-align: center;
            color: var(--primary);
            font-size: 0.9rem;
            margin-bottom: 15px;
            padding: 10px;
            background: rgba(0, 255, 136, 0.1);
            border-radius: 10px;
            border: 1px dashed var(--primary);
            display: none;
        }
        
        .pdf-progress {
            width: 100%;
            height: 6px;
            background: #333;
            border-radius: 3px;
            margin-top: 8px;
            overflow: hidden;
        }
        
        .pdf-progress-bar {
            height: 100%;
            background: var(--gradient-primary);
            border-radius: 3px;
            transition: width 0.3s;
        }
        
        #preview-container {
            display: none;
            text-align: center;
            margin-bottom: 15px;
            padding: 15px;
            background: rgba(0, 255, 136, 0.05);
            border-radius: 15px;
            border: 2px dashed var(--primary);
        }
        
        #preview-img {
            height: 80px;
            border-radius: 10px;
            border: 2px solid var(--primary);
            object-fit: cover;
        }
        
        .preview-close {
            color: var(--error);
            cursor: pointer;
            margin-right: 15px;
            font-size: 1.3rem;
            transition: 0.3s;
        }
        
        .preview-close:hover {
            transform: scale(1.2);
        }
        
        /* Ø¨Ø·Ø§Ù‚Ø§Øª Ø§Ù„Ù…ØµØ§Ø¯Ø± */
        .source-card {
            display: inline-flex;
            align-items: center;
            gap: 10px;
            background: #222;
            padding: 8px 15px;
            border-radius: 12px;
            margin-top: 15px;
            text-decoration: none;
            color: var(--primary);
            font-size: 0.85rem;
            border: 1px solid #333;
            transition: 0.3s;
            margin-right: 10px;
        }
        
        .source-card:hover {
            background: #2a2a2a;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }
        
        .source-card img {
            width: 20px;
            height: 20px;
            border-radius: 4px;
        }
        
        #counter {
            text-align: center;
            font-size: 0.9rem;
            color: var(--primary);
            font-weight: 800;
            margin-bottom: 15px;
            padding: 8px 15px;
            background: rgba(0, 255, 136, 0.1);
            border-radius: 12px;
            display: inline-block;
        }
        
        /* Ù…ÙˆØ¯Ø§Ù„ Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            z-index: 1500;
            justify-content: center;
            align-items: center;
            backdrop-filter: blur(5px);
        }
        
        .modal-content {
            background: #0a0a0a;
            padding: 40px;
            border-radius: 30px;
            border: 2px solid var(--primary);
            text-align: center;
            max-width: 450px;
            width: 90%;
            box-shadow: 0 0 40px rgba(0, 255, 136, 0.3);
        }
        
        .dot {
            display: inline-block;
            animation: wave 1.3s infinite;
            margin: 0 3px;
            color: var(--primary);
            font-weight: 800;
        }
        
        @keyframes wave {
            0%, 60%, 100% { transform: translateY(0); }
            30% { transform: translateY(-10px); }
        }
        
      /* ØªØ­Ø¯ÙŠØ« Ø±Ø³Ø§Ù„Ø© Ø§Ù„ØªØ±Ø­ÙŠØ¨ */
.welcome-center-message {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background: rgba(10, 10, 10, 0.95);
    border: 2px solid var(--primary);
    border-radius: 50px;
    padding: 30px 60px;
    max-width: 600px;
    width: auto;
    min-width: 400px;
    text-align: center;
    backdrop-filter: blur(15px);
    box-shadow: 0 0 50px rgba(212, 175, 55, 0.3);
    z-index: 1000;
    animation: glowFadeIn 0.6s ease-out;
}

@keyframes glowFadeIn {
    from {
        opacity: 0;
        transform: translate(-50%, -40%);
    }
    to {
        opacity: 1;
        transform: translate(-50%, -50%);
    }
}

.welcome-center-title {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 15px;
    font-size: 3rem;
    font-weight: 800;
}

.hello-text {
    color: #ffffff;
    text-shadow: 0 0 10px rgba(255, 255, 255, 0.5);
}

.user-gold-name {
    color: var(--primary);
    background: var(--gradient-primary);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
    text-shadow: 0 0 20px rgba(212, 175, 55, 0.5);
    animation: goldPulse 2s infinite ease-in-out;
}

/* Ù„Ù„Ø¬ÙˆØ§Ù„ */
@media (max-width: 767px) {
    .welcome-center-message {
        padding: 20px 30px;
        min-width: 280px;
    }
    
    .welcome-center-title {
        font-size: 2.2rem;
        gap: 10px;
    }
}
        
        
        
        .welcome-center-title .user-name {
            font-size: 2.2rem;
            background: var(--gradient-primary);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            animation: gradientShift 3s ease infinite;
        }
        
        @keyframes gradientShift {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }
        
        .welcome-center-text {
            color: #ddd;
            line-height: 1.7;
            margin-bottom: 25px;
            font-size: 1.1rem;
        }
        
        .welcome-center-features {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 15px;
            margin-top: 25px;
        }
        
        .welcome-center-feature {
            background: rgba(255, 255, 255, 0.05);
            padding: 18px;
            border-radius: 15px;
            text-align: center;
            transition: 0.3s;
            border: 1px solid transparent;
        }
        
        .welcome-center-feature:hover {
            background: rgba(0, 255, 136, 0.1);
            transform: translateY(-5px);
            border-color: var(--primary);
        }
        
        .welcome-center-feature i {
            color: var(--primary);
            font-size: 1.8rem;
            margin-bottom: 12px;
        }
        
        .welcome-center-feature h4 {
            color: var(--primary);
            margin-bottom: 8px;
            font-size: 1.1rem;
            font-weight: 700;
        }
        
        .welcome-center-feature p {
            color: #aaa;
            font-size: 0.9rem;
            line-height: 1.5;
        }
        
        /* ØªØ­Ù…ÙŠÙ„ PDF */
        .pdf-section {
            background: rgba(0, 255, 136, 0.05);
            border: 1px solid var(--primary);
            border-radius: 15px;
            padding: 20px;
            margin: 15px 0;
        }
        
        .pdf-section-title {
            color: var(--primary);
            font-weight: 800;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .pdf-section-content {
            color: #ccc;
            line-height: 1.8;
            font-size: 0.95rem;
            max-height: 300px;
            overflow-y: auto;
            padding: 10px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 8px;
        }
        
        /* Ù…Ø¤Ø´Ø± Ø§Ù„ØªØ­Ù…ÙŠÙ„ */
        .loading-dots {
            display: flex;
            justify-content: center;
            gap: 5px;
        }
        
        .loading-dot {
            width: 8px;
            height: 8px;
            background: var(--primary);
            border-radius: 50%;
            animation: bounce 1.4s infinite ease-in-out both;
        }
        
        .loading-dot:nth-child(1) { animation-delay: -0.32s; }
        .loading-dot:nth-child(2) { animation-delay: -0.16s; }
        
        @keyframes bounce {
            0%, 80%, 100% { transform: scale(0); }
            40% { transform: scale(1); }
        }
        
        /* --- ØªØµÙ…ÙŠÙ… Ù…ØªØ¬Ø§ÙˆØ¨ Ù„Ù„Ø¬ÙˆØ§Ù„ ÙˆØ§Ù„Ù„Ø§Ø¨ØªÙˆØ¨ --- */
        
        /* Ù„Ù„Ø¬ÙˆØ§Ù„ (Ø£Ù‚Ù„ Ù…Ù† 768px) */
        @media (max-width: 767px) {
            .auth-container {
                padding: 30px 20px;
                margin: 15px;
            }
            
            #chat-box {
                padding: 15px 4%;
                margin-bottom: 10px;
            }
            
            .input-area {
                padding: 15px 4% 20px;
                position: fixed;
                bottom: 0;
                left: 0;
                right: 0;
                background: #0a0a0a;
                border-top: 2px solid #222;
                z-index: 100;
            }
            
            .input-container {
                padding: 12px;
                border-radius: 25px;
            }
            
            .input-container textarea {
                font-size: 1rem;
                max-height: 120px;
            }
            
            .msg {
                max-width: 90%;
                font-size: 0.95rem;
                padding: 14px;
            }
            
            .msg.user {
                padding: 10px 16px;
                font-size: 0.9rem;
            }
            
            .user-profile {
                padding: 6px 10px;
                background: transparent;
            }
            
            .user-name {
                display: none;
            }
            
            .plus-btn {
                padding: 6px 15px;
                font-size: 0.85rem;
            }
            
            .user-dropdown {
                bottom: 70px;
                left: 15px;
                width: 220px;
            }
            
            .dropdown-header {
                padding: 15px;
            }
            
            .dropdown-avatar {
                width: 45px;
                height: 45px;
            }
            
            .dropdown-item {
                padding: 12px 15px;
                font-size: 0.9rem;
            }
            
            #sidebar {
                width: 280px;
                right: -280px;
            }
            
            .sidebar-btn {
                padding: 12px;
                font-size: 0.9rem;
            }
            
            .welcome-center-message {
                padding: 25px;
                width: 95%;
                top: 45%;
            }
            
            .welcome-center-title {
                font-size: 1.8rem;
                flex-direction: column;
                gap: 5px;
            }
            
            .welcome-center-title .user-name {
                font-size: 1.8rem;
            }
            
            .welcome-center-text {
                font-size: 1rem;
                margin-bottom: 20px;
            }
            
            .welcome-center-features {
                grid-template-columns: 1fr;
                gap: 12px;
            }
            
            .welcome-center-feature {
                padding: 15px;
            }
            
            .web-search-toggle {
                font-size: 0.8rem;
                padding: 6px 15px;
                margin-bottom: 15px;
            }
            
            .action-icon {
                font-size: 1.3rem;
                padding: 6px;
            }
            
            .send-btn-small {
                width: 44px;
                height: 44px;
                font-size: 1.1rem;
            }
        }
        
        /* Ù„Ù„ØªØ§Ø¨Ù„Øª (Ù…Ù† 768px Ø¥Ù„Ù‰ 1024px) */
        @media (min-width: 768px) and (max-width: 1024px) {
            #chat-box {
                padding: 20px 6%;
                max-width: 900px;
            }
            
            .input-area {
                padding: 18px 6% 25px;
                max-width: 900px;
            }
            
            .welcome-center-message {
                max-width: 700px;
                padding: 30px;
            }
            
            .welcome-center-title {
                font-size: 2rem;
            }
            
            .welcome-center-title .user-name {
                font-size: 2rem;
            }
            
            .welcome-center-features {
                grid-template-columns: repeat(2, 1fr);
            }
        }
        
       /* Ù„Ù„Ù„Ø§Ø¨ØªÙˆØ¨/Ø³Ø·Ø­ Ø§Ù„Ù…ÙƒØªØ¨ (Ø£ÙƒØ«Ø± Ù…Ù† 1024px) */
@media (min-width: 1025px) {
    #chat-box {
        padding: 30px 10%; /* Ù…Ø³Ø§Ø­Ø© Ø¬Ø§Ù†Ø¨ÙŠØ© Ø£ÙƒØ¨Ø± */
        max-width: 1600px; /* Ø²ÙˆØ¯ Ù„Ù€ 1600px */
    }
    
    .input-area {
        padding: 25px 10% 35px;
        max-width: 1600px;
    }
    
    .msg {
        max-width: 85%; /* Ø®Ù„ÙŠÙ‡Ø§ 85% Ø¹Ø´Ø§Ù† Ù…Ø§ ØªÙƒÙˆÙ† Ø¹Ø±ÙŠØ¶Ø© Ø²ÙŠØ§Ø¯Ø© */
        font-size: 1.1rem;
        padding: 22px 28px;
    }
    
    .welcome-center-message {
        max-width: 900px; /* ÙƒØ¨Ø± Ø±Ø³Ø§Ù„Ø© Ø§Ù„ØªØ±Ø­ÙŠØ¨ */
        padding: 45px;
    }
}
            
            .welcome-center-title {
                font-size: 2.5rem;
            }
            
            .welcome-center-title .user-name {
                font-size: 2.5rem;
            }
            
            .welcome-center-features {
                grid-template-columns: repeat(4, 1fr);
            }
            
            .user-dropdown {
                bottom: 100px;
                left: 30px;
                width: 280px;
            }
        }
        
        /* ØªØ­Ø³ÙŠÙ†Ø§Øª Ø¹Ø§Ù…Ø© Ù„Ù„Ø§Ø³ØªØ¬Ø§Ø¨Ø© */
        @media (max-width: 767px) {
            body {
                height: calc(100vh - env(safe-area-inset-bottom));
            }
            
            header {
                padding: 12px 4%;
                position: sticky;
                top: 0;
            }
            
            .logo {
                font-size: 1.5rem;
            }
            
            .menu-toggle {
                font-size: 1.3rem;
            }
            
            .ai-icon {
                width: 36px;
                height: 36px;
                font-size: 1rem;
            }
            
            #pdf-info {
                margin-bottom: 10px;
                padding: 8px;
                font-size: 0.85rem;
            }
            
            #counter {
                font-size: 0.85rem;
                margin-bottom: 12px;
                padding: 6px 12px;
            }
        }
        
        /* ØªØ­Ø³ÙŠÙ†Ø§Øª Ù„Ù„ØªØ¬Ø±Ø¨Ø© Ø¹Ù„Ù‰ Ø§Ù„Ø´Ø§Ø´Ø§Øª Ø§Ù„ØµØºÙŠØ±Ø© Ø¬Ø¯Ø§Ù‹ */
        @media (max-width: 360px) {
            .welcome-center-title {
                font-size: 1.6rem;
            }
            
            .welcome-center-title .user-name {
                font-size: 1.6rem;
            }
            
            .welcome-center-text {
                font-size: 0.9rem;
            }
            
            .user-dropdown {
                width: 200px;
                left: 10px;
                bottom: 60px;
            }
            
            .plus-btn {
                padding: 5px 12px;
                font-size: 0.8rem;
            }
.company-triangle {
    position: fixed;
    top: 15px;
    left: 20px; /* Ù„Ø£Ù†Ù‡ Ø§Ù„Ù…ÙˆÙ‚Ø¹ RTL */
    width: 0;
    height: 0;
    border-left: 12px solid transparent;
    border-right: 12px solid transparent;
    border-bottom: 24px solid #F3E5AB;
    filter: drop-shadow(0 0 8px #D4AF37);
    z-index: 3000;
cursor: pointer;
}

/* ğŸ‘‘ Ø§Ù„Ù„Ù…Ø¹Ø© Ø§Ù„ÙØ®Ù…Ø© */
.company-triangle:hover {
    border-bottom: 24px solid #D4AF37;
    filter: drop-shadow(0 0 20px #D4AF37)
            drop-shadow(0 0 40px rgba(212,175,55,0.6));
    transform: scale(1.15);
}
@keyframes goldPulse {
    0% {
        filter: drop-shadow(0 0 8px #D4AF37);
    }
    50% {
        filter: drop-shadow(0 0 18px #D4AF37);
    }
    100% {
        filter: drop-shadow(0 0 8px #D4AF37);
    }
}

.company-triangle {
    animation: goldPulse 2.5s infinite ease-in-out;

       }
    </style>
</head>
<body>
<div class="company-triangle"></div>

<!-- Ù†Ø§ÙØ°Ø© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ù…Ø¹ Google -->
<div id="auth-overlay">
    <div class="auth-container">
        <div class="auth-title">Glow.ai</div>
        <div class="auth-subtitle">Ù…Ø³Ø§Ø¹Ø¯ ØªØ¹Ù„ÙŠÙ…ÙŠ Ø°ÙƒÙŠ ÙŠØ³Ø§Ø¹Ø¯Ùƒ ÙÙŠ ÙÙ‡Ù… Ø§Ù„Ù…ÙˆØ§Ø¯ Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠØ© ÙˆØªØ­Ù„ÙŠÙ„ Ø§Ù„Ù…Ù„ÙØ§Øª Ø§Ù„ØªØ¹Ù„ÙŠÙ…ÙŠØ© Ø¨Ø°ÙƒØ§Ø¡ Ø§ØµØ·Ù†Ø§Ø¹ÙŠ Ù…ØªÙ‚Ø¯Ù…</div>
        
        <div class="auth-features">
            <div class="feature-item">
                <div class="feature-icon">
                    <i class="fas fa-brain"></i>
                </div>
                <div class="feature-text">
                    <h4>Ø°ÙƒØ§Ø¡ Ø§ØµØ·Ù†Ø§Ø¹ÙŠ Ù…ØªÙ‚Ø¯Ù…</h4>
                    <p>Ø¥Ø¬Ø§Ø¨Ø§Øª Ø¯Ù‚ÙŠÙ‚Ø© Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø£Ø­Ø¯Ø« Ù†Ù…Ø§Ø°Ø¬ Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ</p>
                </div>
            </div>
            
            <div class="feature-item">
                <div class="feature-icon">
                    <i class="fas fa-file-pdf"></i>
                </div>
                <div class="feature-text">
                    <h4>ØªØ­Ù„ÙŠÙ„ Ù…Ù„ÙØ§Øª PDF ÙƒØ§Ù…Ù„Ø©</h4>
                    <p>ØªØ­Ù…ÙŠÙ„ ÙˆØªØ­Ù„ÙŠÙ„ Ù…Ù„ÙØ§Øª PDF Ø­ØªÙ‰ 10MB Ø¨Ø§Ù„ÙƒØ§Ù…Ù„</p>
                </div>
            </div>
            
            <div class="feature-item">
                <div class="feature-icon">
                    <i class="fas fa-graduation-cap"></i>
                </div>
                <div class="feature-text">
                    <h4>Ù…Ø³Ø§Ø¹Ø¯ ØªØ¹Ù„ÙŠÙ…ÙŠ Ø´Ø®ØµÙŠ</h4>
                    <p>Ù…Ø³Ø§Ø¹Ø¯ØªÙƒ ÙÙŠ ÙÙ‡Ù… Ø§Ù„Ù…ÙˆØ§Ø¯ Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠØ© ÙˆØ§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø¹Ù„Ù‰ Ø£Ø³Ø¦Ù„ØªÙƒ</p>
                </div>
            </div>
        </div>
        
        <div id="g_id_onload"
            data-client_id="424181196939-seqcnjedep4a484uumkvnoi65mla3hvb.apps.googleusercontent.com"
            data-context="signin"
            data-ux_mode="popup"
            data-callback="handleGoogleSignIn"
            data-auto_prompt="false">
        </div>

        <div class="g_id_signin"
            data-type="standard"
            data-shape="rectangular"
            data-theme="outline"
            data-text="signin_with"
            data-size="large"
            data-logo_alignment="left"
            data-width="300">
        </div>
        
        <div class="auth-footer">
            Ø¨ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ØŒ ÙØ¥Ù†Ùƒ ØªÙˆØ§ÙÙ‚ Ø¹Ù„Ù‰ <a href="#">Ø´Ø±ÙˆØ· Ø§Ù„Ø®Ø¯Ù…Ø©</a> Ùˆ<a href="#">Ø³ÙŠØ§Ø³Ø© Ø§Ù„Ø®ØµÙˆØµÙŠØ©</a><br>
            ØªØ·ÙˆÙŠØ±: Ù…. Ø£Ø­Ù…Ø¯ Ø§Ù„Ø£Ø³Ø·Ù„
        </div>
    </div>
</div>

<!-- Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ù†Ø³Ø¯Ù„Ø© Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù… (Ø§Ù„Ø²Ø§ÙˆÙŠØ© Ø§Ù„Ø³ÙÙ„ÙŠØ© Ø§Ù„ÙŠØ³Ø±Ù‰) -->
<div id="user-dropdown" class="user-dropdown">
    <div class="dropdown-header">
        <img id="dropdown-avatar" class="dropdown-avatar" src="" alt="ØµÙˆØ±Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…">
        <div class="dropdown-user-info">
            <div id="dropdown-user-name" class="dropdown-user-name"></div>
            <div id="dropdown-user-email" class="dropdown-user-email"></div>
        </div>
    </div>
    <div class="dropdown-body">
        <div class="dropdown-item" onclick="startNewChat()">
            <i class="fas fa-plus-circle"></i>
            Ù…Ø­Ø§Ø¯Ø«Ø© Ø¬Ø¯ÙŠØ¯Ø©
        </div>
        <div class="dropdown-item" onclick="toggleSidebar()">
            <i class="fas fa-history"></i>
            Ø³Ø¬Ù„ Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø§Øª
        </div>
        <div class="dropdown-item" onclick="showPlusModal()">
            <i class="fas fa-crown"></i>
            ØªØ±Ù‚ÙŠØ© Ø¥Ù„Ù‰ PLUS
        </div>
        <div class="dropdown-item" onclick="window.open('https://www.moe.edu.ps/gaza/subjects', '_blank')">
            <i class="fas fa-download"></i>
            Ø§Ù„Ø±Ø²Ù… Ø§Ù„ØªØ¹Ù„ÙŠÙ…ÙŠØ©
        </div>
        <div class="dropdown-item logout-btn" onclick="logout()">
            <i class="fas fa-sign-out-alt"></i>
            ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬
        </div>
    </div>
</div>

<!-- Ø§Ù„Ø´Ø±ÙŠØ· Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠ -->
<div id="sidebar">
    <div class="sidebar-header">
        <h3>Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©</h3>
        <i class="fas fa-times sidebar-close" onclick="toggleSidebar()"></i>
    </div>
    <div class="sidebar-btn new-chat-btn" onclick="startNewChat()">
        <i class="fas fa-plus"></i> Ù…Ø­Ø§Ø¯Ø«Ø© Ø¬Ø¯ÙŠØ¯Ø©
    </div>
    <a href="https://www.moe.edu.ps/gaza/subjects" target="_blank" class="sidebar-btn moe-btn">
        <i class="fas fa-download"></i> ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø±Ø²Ù… Ø§Ù„ØªØ¹Ù„ÙŠÙ…ÙŠØ©
    </a>
    <div class="history-list" id="history-list"></div>
</div>

<!-- Ø§Ù„Ù‡ÙŠØ¯Ø± -->
<header>
    <div class="logo-area">
        <i class="fas fa-bars menu-toggle" onclick="toggleSidebar()"></i>
        <div class="logo" onclick="location.reload()">
            <i class="fas fa-graduation-cap"></i> Glow<span>.ai</span>
        </div>
    </div>
    
    <div class="user-area">
        <div id="user-profile" class="user-profile" style="display: none;" onclick="toggleUserDropdown()">
            <img id="user-avatar" class="user-avatar" src="" alt="ØµÙˆØ±Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…">
            <span id="user-name" class="user-name"></span>
        </div>
        
        <button id="auth-btn" onclick="showAuth()" style="display: none;">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</button>
        <button id="plus-btn" class="plus-btn" onclick="showPlusModal()">GLOW PLUS</button>
        <div id="admin-tag" class="admin-status">Hello Admin</div>
    </div>
</header>

<!-- Ø±Ø³Ø§Ù„Ø© ØªØ±Ø­ÙŠØ¨ Ù…Ø±ÙƒØ²ÙŠØ© - ÙÙ‚Ø· Ù‡Ø§Ø¯ÙŠ -->
<div id="welcome-center-message" class="welcome-center-message" style="display: none;">
    <div class="welcome-center-title">
        <span class="hello-text">Hello</span>
        <span id="welcome-user-name" class="user-gold-name"></span>
    </div>
    
<!-- Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ø¯Ø±Ø¯Ø´Ø© -->
<div id="chat-box"></div>

<!-- Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„ -->
<div class="input-area">
    <div class="web-search-toggle" id="webSearchBtn" onclick="toggleWebSearch()">
        <i class="fas fa-globe"></i>
        <span>Web Search</span>
    </div>
    
    <div id="preview-container">
        <i class="fas fa-times-circle preview-close" onclick="cancelImage()"></i>
        <img id="preview-img" src="">
    </div>
    
    <div id="pdf-info">
        <div id="pdf-status"></div>
        <div class="pdf-progress">
            <div class="pdf-progress-bar" id="pdf-progress-bar"></div>
        </div>
    </div>
    
    <p id="counter"></p>
    
    <div class="input-container">
        <div class="input-actions">
            <label for="file-input" class="action-icon" title="Ø±ÙØ¹ Ù…Ù„Ù PDF">
                <i class="fas fa-file-pdf"></i>
            </label>
            <input type="file" id="file-input" accept="application/pdf" style="display:none" onchange="processPDF(this)">
            
            <label for="image-input" class="action-icon" title="Ø±ÙØ¹ ØµÙˆØ±Ø©">
                <i class="fas fa-camera"></i>
            </label>
            <input type="file" id="image-input" accept="image/*" style="display:none" onchange="previewImage(this)">
        </div>
        
        <textarea id="userInput" rows="1" placeholder="Ø§Ø³Ø£Ù„ Glow Ø¹Ù† Ø£ÙŠ Ø´ÙŠØ¡..." oninput="autoResize(this)"></textarea>
        
        <button id="sendBtn" class="send-btn-small" onclick="askAI()">
            <i id="sendIcon" class="fas fa-paper-plane"></i>
        </button>
    </div>
</div>

<!-- Ù…ÙˆØ¯Ø§Ù„ Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ -->
<div id="plusModal" class="modal">
    <div class="modal-content">
        <h2 style="color:var(--primary); margin-bottom:15px;">Ø§Ù†ØªÙ‡Øª Ù…Ø­Ø§ÙˆÙ„Ø§ØªÙƒ! ğŸš€</h2>
        <p style="color:#ccc; margin-bottom:20px;">Ø§Ø´ØªØ±Ùƒ Ø§Ù„Ø¢Ù† ÙÙŠ GLOW PLUS Ù„Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ ÙˆØµÙˆÙ„ ØºÙŠØ± Ù…Ø­Ø¯ÙˆØ¯.</p>
        <button onclick="closeModal('plusModal')" style="background:none; border:1px solid #555; color:#555; padding:10px 25px; border-radius:12px; cursor:pointer; transition:0.3s;">Ø¥ØºÙ„Ø§Ù‚</button>
    </div>
</div>

<script>
    // ØªÙ‡ÙŠØ¦Ø© Ù…ÙƒØªØ¨Ø© PDF.js
    pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.16.105/pdf.worker.min.js';
    
    // --- API KEY Ø§Ù„Ù…Ø­Ø¯Ø«Ø© ---
    const API_KEY = "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";
    
    // --- Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø®Ø§ØµØ© ---
    const MY_ADMIN_IP = "213.6.209.127"; 
    // -------------------------
    
    // Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„Ù†Ø¸Ø§Ù…
    let currentUser = null;
    let pdfText = "";
    let chatHistory = [];
    let selectedImageBase64 = null;
    let currentChatId = Date.now();
    let isWebSearch = false;
    let isAdmin = false;
    let isTyping = false;
    let typingInterval = null;
    let pdfPages = [];
    let uploadedFileName = "";
    let pdfProcessing = false;
    let dropdownOpen = false;
    
    // ØªØ¹Ø±ÙŠÙ Ù…Ø¹Ø±Ù Ø§Ù„Ø¬Ù‡Ø§Ø²
    const deviceId = btoa(navigator.userAgent).substring(0, 15);
    let attempts = localStorage.getItem('Glow_usage_' + deviceId) || 10;
    
    // ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚
    window.onload = async () => {
        // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø§Ù„Ø³Ø§Ø¨Ù‚
        const savedUser = localStorage.getItem('glow_current_user');
        if (savedUser) {
            currentUser = JSON.parse(savedUser);
            updateUserUI();
            document.getElementById('auth-overlay').style.display = 'none';
            
            // Ø¥Ø¸Ù‡Ø§Ø± Ø±Ø³Ø§Ù„Ø© Ø§Ù„ØªØ±Ø­ÙŠØ¨ Ø§Ù„Ù…Ø±ÙƒØ²ÙŠØ©
            showCenterWelcome();
        } else {
            document.getElementById('auth-overlay').style.display = 'flex';
        }
        
        // ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ù†Ø¸Ø§Ù…
        loadHistory();
        startNewChat();
        await checkAdminStatus();
        syncUI();
        
        // ØªÙ‡ÙŠØ¦Ø© Google Sign-In
        initializeGoogleSignIn();
        
        // Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ù†Ø³Ø¯Ù„Ø© Ø¹Ù†Ø¯ Ø§Ù„Ù†Ù‚Ø± Ø®Ø§Ø±Ø¬Ù‡Ø§
        document.addEventListener('click', function(event) {
            const dropdown = document.getElementById('user-dropdown');
            const profile = document.getElementById('user-profile');
            
            if (dropdownOpen && !dropdown.contains(event.target) && !profile.contains(event.target)) {
                closeUserDropdown();
            }
        });
    };
    
    // --- ØªÙ‡ÙŠØ¦Ø© Google Sign-In ---
    function initializeGoogleSignIn() {
        // Ø³ÙŠØªÙ… ØªÙ‡ÙŠØ¦ØªÙ‡ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ø¨ÙˆØ§Ø³Ø·Ø© Google
        console.log("Google Sign-In Ø¬Ø§Ù‡Ø²");
    }
    
    // --- Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ø³ØªØ¬Ø§Ø¨Ø© Google Sign-In ---
    function handleGoogleSignIn(response) {
        console.log("Google Sign-In response:", response);
        
        // ÙÙƒ ØªØ´ÙÙŠØ± Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø§Ø¹ØªÙ…Ø§Ø¯
        const credential = response.credential;
        const payload = JSON.parse(atob(credential.split('.')[1]));
        
        console.log("User payload:", payload);
        
        // Ø¥Ù†Ø´Ø§Ø¡ ÙƒØ§Ø¦Ù† Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
        currentUser = {
            id: payload.sub,
            name: payload.name,
            email: payload.email,
            picture: payload.picture,
            verified: payload.email_verified,
            loginMethod: 'google',
            loginDate: new Date().toISOString(),
            attempts: 50 // Ù…Ø­Ø§ÙˆÙ„Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ© Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ø§Ù„Ø¬Ø¯Ø¯
        };
        
        // Ø­ÙØ¸ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
        localStorage.setItem('glow_current_user', JSON.stringify(currentUser));
        
        // ØªØ­Ø¯ÙŠØ« ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
        updateUserUI();
        
        // Ø¥Ø®ÙØ§Ø¡ Ù†Ø§ÙØ°Ø© Ø§Ù„Ù…ØµØ§Ø¯Ù‚Ø©
        document.getElementById('auth-overlay').style.display = 'none';
        
        // Ø¥Ø¸Ù‡Ø§Ø± Ø±Ø³Ø§Ù„Ø© Ø§Ù„ØªØ±Ø­ÙŠØ¨ Ø§Ù„Ù…Ø±ÙƒØ²ÙŠØ©
        showCenterWelcome();
        
        // Ø¥Ø¹Ø·Ø§Ø¡ Ù…Ø­Ø§ÙˆÙ„Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ© Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø¬Ø¯ÙŠØ¯
        attempts = currentUser.attempts;
        localStorage.setItem('Glow_usage_' + deviceId, attempts);
        
        // Ø¨Ø¯Ø¡ Ù…Ø­Ø§Ø¯Ø«Ø© Ø¬Ø¯ÙŠØ¯Ø©
        startNewChat();
        syncUI();
    }
    
   // --- Ø¥Ø¸Ù‡Ø§Ø± Ø±Ø³Ø§Ù„Ø© Ø§Ù„ØªØ±Ø­ÙŠØ¨ Ø§Ù„Ù…Ø±ÙƒØ²ÙŠØ© ---
function showCenterWelcome() {
    if (!currentUser) return;
    
    const welcomeMessage = document.getElementById('welcome-center-message');
    const welcomeUserName = document.getElementById('welcome-user-name');
    
    // Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø§Ø³Ù… ÙÙ‚Ø· (Ø¨Ø¯ÙˆÙ† Ø¨Ø±ÙŠØ¯)
    const userName = currentUser.name || "User";
    welcomeUserName.textContent = userName;
    
    welcomeMessage.style.display = 'block';
    welcomeMessage.style.opacity = '1';
    welcomeMessage.style.transform = 'translate(-50%, -50%)';
}

// ÙˆØ£Ø¶Ù Ù‡Ø§Ø¯ÙŠ Ø§Ù„Ø¯Ø§Ù„Ø© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©
function hideWelcomeMessage() {
    const welcomeMessage = document.getElementById('welcome-center-message');
    if (welcomeMessage.style.display === 'block') {
        welcomeMessage.style.display = 'none';
    }
}
    function updateUserUI() {
    if (currentUser) {
        document.getElementById('user-profile').style.display = 'none'; // Ø¥Ø®ÙØ§Ø¡ Ø§Ù„ØµÙˆØ±Ø© Ù…Ù† Ø§Ù„Ø£Ø¹Ù„Ù‰
        document.getElementById('auth-btn').style.display = 'none';
        
        document.getElementById('dropdown-user-name').textContent = currentUser.name;
        document.getElementById('dropdown-user-email').textContent = currentUser.email;
        
        if (currentUser.picture) {
            document.getElementById('dropdown-avatar').src = currentUser.picture;
        } else {
            const avatarUrl = 'https://ui-avatars.com/api/?name=' + encodeURIComponent(currentUser.name) + '&background=00ff88&color=000&size=50';
            document.getElementById('dropdown-avatar').src = avatarUrl;
        }
        
        // ÙØªØ­ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ù†Ø³Ø¯Ù„Ø© ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ø¨Ø¹Ø¯ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)
        setTimeout(() => {
            toggleUserDropdown();
        }, 500);
    } else {
        document.getElementById('user-profile').style.display = 'none';
        document.getElementById('auth-btn').style.display = 'block';
        closeUserDropdown();
    }
}
    
    function showAuth() {
        document.getElementById('auth-overlay').style.display = 'flex';
        closeUserDropdown();
    }
    
    function logout() {
        // ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬ Ù…Ù† Google
        if (currentUser && currentUser.loginMethod === 'google') {
            google.accounts.id.disableAutoSelect();
            google.accounts.id.revoke(currentUser.email, done => {
                console.log("ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬ Ù…Ù† Google");
            });
        }
        
        // Ù…Ø³Ø­ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
        currentUser = null;
        localStorage.removeItem('glow_current_user');
        
        // ØªØ­Ø¯ÙŠØ« ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
        updateUserUI();
        
        // Ø¥Ø¸Ù‡Ø§Ø± Ù†Ø§ÙØ°Ø© Ø§Ù„Ù…ØµØ§Ø¯Ù‚Ø©
        showAuth();
        
        // Ø¥Ø®ÙØ§Ø¡ Ø±Ø³Ø§Ù„Ø© Ø§Ù„ØªØ±Ø­ÙŠØ¨ Ø§Ù„Ù…Ø±ÙƒØ²ÙŠØ©
        document.getElementById('welcome-center-message').style.display = 'none';
        
        // Ø¨Ø¯Ø¡ Ù…Ø­Ø§Ø¯Ø«Ø© Ø¬Ø¯ÙŠØ¯Ø©
        startNewChat();
    }
    
    // --- Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø­Ø§Ù„Ø© Ø§Ù„Ù…Ø´Ø±Ù ---
    async function checkAdminStatus() {
        try {
            const res = await fetch('https://api.ipify.org?format=json');
            const data = await res.json();
            if (data.ip === MY_ADMIN_IP) {
                isAdmin = true;
                attempts = 999999;
                document.getElementById('admin-tag').style.display = 'block';
            }
        } catch (e) {
            console.error("ÙØ´Ù„ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† IP");
        }
    }
    
    function syncUI() {
        if (isAdmin) {
            document.getElementById('counter').innerText = "â¿ ÙˆØµÙˆÙ„ ÙƒØ§Ù…Ù„";
            document.getElementById('plus-btn').style.display = 'none';
            document.getElementById('admin-tag').style.display = 'block';
        } else if (currentUser && currentUser.attempts) {
            document.getElementById('counter').innerText = `Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø§Øª Ø§Ù„Ù…ØªØ¨Ù‚ÙŠØ©: ${attempts}`;
        } else {
            document.getElementById('counter').innerText = `Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø§Øª Ø§Ù„Ù…ØªØ¨Ù‚ÙŠØ©: ${attempts}`;
        }
    }
    
    // --- ÙˆØ¸Ø§Ø¦Ù Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ù†Ø³Ø¯Ù„Ø© Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù… ---
    function toggleUserDropdown() {
        if (!currentUser) return;
        
        const dropdown = document.getElementById('user-dropdown');
        
        if (dropdownOpen) {
            closeUserDropdown();
        } else {
            dropdownOpen = true;
            dropdown.style.display = 'block';
            
            // ØªØ­Ø¯ÙŠØ¯ Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ù†Ø³Ø¯Ù„Ø©
            const profile = document.getElementById('user-profile');
            const rect = profile.getBoundingClientRect();
            
            // Ø¨Ø§Ù„Ù†Ø³Ø¨Ø© Ù„Ù„Ø¬ÙˆØ§Ù„ØŒ Ù†Ø¬Ø¹Ù„Ù‡Ø§ ÙÙŠ Ø§Ù„Ø²Ø§ÙˆÙŠØ© Ø§Ù„Ø³ÙÙ„ÙŠØ© Ø§Ù„ÙŠØ³Ø±Ù‰
            if (window.innerWidth <= 767) {
                dropdown.style.bottom = '70px';
                dropdown.style.left = '15px';
                dropdown.style.right = 'auto';
            }
        }
    }
    
    function closeUserDropdown() {
        dropdownOpen = false;
        document.getElementById('user-dropdown').style.display = 'none';
    }
    
    // --- ÙˆØ¸Ø§Ø¦Ù Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© ---
    function autoResize(textarea) {
        textarea.style.height = 'auto';
        textarea.style.height = Math.min(textarea.scrollHeight, window.innerWidth <= 767 ? 120 : 200) + 'px';
    }
    
    function toggleWebSearch() {
        isWebSearch = !isWebSearch;
        const btn = document.getElementById('webSearchBtn');
        btn.classList.toggle('active');
        btn.querySelector('span').innerText = isWebSearch ? 'Web Search âœ“' : 'Web Search';
    }
    
    function toggleSidebar() {
        document.getElementById('sidebar').classList.toggle('open');
        closeUserDropdown();
    }
    
    function startNewChat() {
        currentChatId = Date.now();
        chatHistory = [];
        pdfText = "";
        pdfPages = [];
        uploadedFileName = "";
        
        document.getElementById('chat-box').innerHTML = "";
        document.getElementById('pdf-info').style.display = 'none';
        
        if (currentUser) {
            // Ù„Ø§ Ù†Ø¹Ø±Ø¶ Ø±Ø³Ø§Ù„Ø© Ù‡Ù†Ø§ Ù„Ø£Ù† Ù„Ø¯ÙŠÙ†Ø§ Ø§Ù„Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ù…Ø±ÙƒØ²ÙŠØ©
        } else {
            addMessage("Ø£Ù‡Ù„Ø§Ù‹ Ø¨Ùƒ ÙÙŠ Glow Ø§Ù„ØªØ¹Ù„ÙŠÙ…ÙŠ.. ÙƒÙŠÙ ÙŠÙ…ÙƒÙ†Ù†ÙŠ Ù…Ø³Ø§Ø¹Ø¯ØªÙƒØŸ", "ai", false);
        }
        
        if (pdfPages.length > 0) {
            showPDFUploadedMessage();
        }
        
        closeUserDropdown();
    }
    
    // --- Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„ØµÙˆØ± ---
    function previewImage(input) {
        const file = input.files[0];
        if (!file) return;
        
        const maxSize = window.innerWidth <= 767 ? 3 * 1024 * 1024 : 5 * 1024 * 1024;
        if (file.size > maxSize) {
            alert(`Ø­Ø¬Ù… Ø§Ù„ØµÙˆØ±Ø© ÙƒØ¨ÙŠØ± Ø¬Ø¯Ø§Ù‹. Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰ ${Math.round(maxSize/(1024*1024))}MB`);
            return;
        }
        
        const reader = new FileReader();
        reader.onload = (e) => {
            selectedImageBase64 = e.target.result.split(',')[1];
            document.getElementById('preview-img').src = e.target.result;
            document.getElementById('preview-container').style.display = 'block';
        };
        reader.readAsDataURL(file);
    }
    
    function cancelImage() {
        selectedImageBase64 = null;
        document.getElementById('preview-container').style.display = 'none';
        document.getElementById('image-input').value = '';
    }
    
    // --- Ù…Ø¹Ø§Ù„Ø¬Ø© Ù…Ù„ÙØ§Øª PDF (Ù…Ø­Ø³Ù‘Ù†Ø© Ù„Ù„Ù€ 10MB) ---
    async function processPDF(input) {
        if (pdfProcessing) {
            alert("Ø¬Ø§Ø± Ù…Ø¹Ø§Ù„Ø¬Ø© Ù…Ù„Ù PDF Ø¨Ø§Ù„ÙØ¹Ù„. ÙŠØ±Ø¬Ù‰ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±...");
            return;
        }
        
        const file = input.files[0];
        if (!file) return;
        
        uploadedFileName = file.name;
        const infoDiv = document.getElementById('pdf-info');
        const statusDiv = document.getElementById('pdf-status');
        const progressBar = document.getElementById('pdf-progress-bar');
        
        infoDiv.style.display = 'block';
        statusDiv.innerHTML = `Ø¬Ø§Ø± ØªØ­Ù…ÙŠÙ„ "${file.name}"... â³`;
        progressBar.style.width = '5%';
        
        // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø­Ø¬Ù… Ø§Ù„Ù…Ù„Ù (Ø²ÙŠØ§Ø¯Ø© Ø§Ù„Ø­Ø¯ Ø¥Ù„Ù‰ 10MB)
        const maxSize = 10 * 1024 * 1024; // 10MB
        if (file.size > maxSize) {
            statusDiv.innerHTML = `Ø­Ø¬Ù… Ø§Ù„Ù…Ù„Ù ÙƒØ¨ÙŠØ± Ø¬Ø¯Ø§Ù‹ (${Math.round(file.size / (1024*1024))}MB). Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰ 10MB âŒ`;
            progressBar.style.width = '0%';
            return;
        }
        
        pdfProcessing = true;
        
        try {
            const reader = new FileReader();
            reader.onload = async function() {
                try {
                    const typedarray = new Uint8Array(this.result);
                    const pdf = await pdfjsLib.getDocument({
                        data: typedarray,
                        cMapUrl: 'https://cdn.jsdelivr.net/npm/pdfjs-dist@2.16.105/cmaps/',
                        cMapPacked: true
                    }).promise;
                    
                    const totalPages = pdf.numPages;
                    
                    // Ø¥Ø¹Ø§Ø¯Ø© ØªÙ‡ÙŠØ¦Ø© Ù…ØªØºÙŠØ± PDF
                    pdfText = "";
                    pdfPages = [];
                    
                    // ØªØ­Ù…ÙŠÙ„ Ø¬Ù…ÙŠØ¹ Ø§Ù„ØµÙØ­Ø§Øª Ø¨Ø´ÙƒÙ„ ØªØ¯Ø±ÙŠØ¬ÙŠ
                    for (let i = 1; i <= totalPages; i++) {
                        const page = await pdf.getPage(i);
                        const content = await page.getTextContent();
                        
                        // ØªØ¬Ù…ÙŠØ¹ Ù†Øµ Ø§Ù„ØµÙØ­Ø© Ø¨ÙƒÙØ§Ø¡Ø©
                        const pageText = content.items.map(item => item.str).join(" ");
                        pdfPages.push({
                            page: i,
                            text: pageText
                        });
                        
                        pdfText += `\n\n--- Ø§Ù„ØµÙØ­Ø© ${i} ---\n${pageText}`;
                        
                        // ØªØ­Ø¯ÙŠØ« Ø´Ø±ÙŠØ· Ø§Ù„ØªÙ‚Ø¯Ù…
                        const progress = Math.round((i / totalPages) * 90) + 5;
                        progressBar.style.width = `${progress}%`;
                        statusDiv.innerHTML = `Ø¬Ø§Ø± Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„ØµÙØ­Ø© ${i} Ù…Ù† ${totalPages}... ğŸ“„ (${Math.round(pdfText.length / 1024)}KB)`;
                        
                        // Ø¥Ø¹Ø·Ø§Ø¡ ÙØ±ØµØ© Ù„Ù„Ù…ØªØµÙØ­ Ù„Ù„ØªÙ†ÙØ³ (ØªÙ‚Ù„ÙŠÙ„ Ø§Ù„ØªØ£Ø®ÙŠØ±)
                        if (i % 3 === 0) await new Promise(resolve => setTimeout(resolve, 30));
                    }
                    
                    // ØªØ­Ù…ÙŠÙ„ ÙƒØ§Ù…Ù„ Ø§Ù„Ù†Ø¬Ø§Ø­
                    progressBar.style.width = '100%';
                    const totalSizeKB = Math.round(pdfText.length / 1024);
                    statusDiv.innerHTML = `âœ… ØªÙ… ØªØ­Ù…ÙŠÙ„ ${totalPages} ØµÙØ­Ø© Ø¨Ø§Ù„ÙƒØ§Ù…Ù„ (${totalSizeKB}KB)`;
                    
                    // Ø¥Ø¸Ù‡Ø§Ø± Ø±Ø³Ø§Ù„Ø© ÙÙŠ Ø§Ù„Ø¯Ø±Ø¯Ø´Ø©
                    showPDFUploadedMessage();
                    
                    // Ø­ÙØ¸ ÙÙŠ Ø§Ù„ØªØ®Ø²ÙŠÙ† Ø§Ù„Ù…Ø­Ù„ÙŠ
                    savePDFToStorage();
                    
                    // Ø¥Ø¸Ù‡Ø§Ø± Ø±Ø³Ø§Ù„Ø© Ù†Ø¬Ø§Ø­
                    addMessage(`ØªÙ… ØªØ­Ù…ÙŠÙ„ Ù…Ù„Ù PDF "${uploadedFileName}" Ø¨Ù†Ø¬Ø§Ø­! ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ù„Ø¢Ù† Ø·Ø±Ø­ Ø£Ø³Ø¦Ù„Ø© Ø­ÙˆÙ„ Ù…Ø­ØªÙˆØ§Ù‡.`, "ai", false);
                    
                } catch (err) {
                    console.error("Ø®Ø·Ø£ ÙÙŠ Ù‚Ø±Ø§Ø¡Ø© PDF:", err);
                    statusDiv.innerHTML = "Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ù…Ù„Ù âŒ";
                    progressBar.style.width = '0%';
                    addMessage("Ø¹Ø°Ø±Ø§Ù‹ØŒ Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ù…Ù„Ù PDF. ÙŠØ±Ø¬Ù‰ Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† Ø£Ù† Ø§Ù„Ù…Ù„Ù ØµØ§Ù„Ø­ ÙˆØ­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.", "ai", false);
                } finally {
                    pdfProcessing = false;
                }
            };
            
            reader.onerror = function() {
                statusDiv.innerHTML = "Ø®Ø·Ø£ ÙÙŠ Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ù…Ù„Ù âŒ";
                progressBar.style.width = '0%';
                pdfProcessing = false;
            };
            
            reader.readAsArrayBuffer(file);
            
        } catch (error) {
            console.error("Ø®Ø·Ø£ ÙÙŠ Ù…Ø¹Ø§Ù„Ø¬Ø© PDF:", error);
            statusDiv.innerHTML = "Ø­Ø¯Ø« Ø®Ø·Ø£ ØºÙŠØ± Ù…ØªÙˆÙ‚Ø¹ âŒ";
            progressBar.style.width = '0%';
            pdfProcessing = false;
        }
    }
    
    function showPDFUploadedMessage() {
        if (pdfPages.length === 0) return;
        
        const chatBox = document.getElementById('chat-box');
        const messageDiv = document.createElement('div');
        messageDiv.className = 'msg-wrapper ai-wrapper';
        
        const totalSizeKB = Math.round(pdfText.length / 1024);
        
        let content = `<div class="pdf-section">
            <div class="pdf-section-title">
                <i class="fas fa-file-pdf"></i>
                ${uploadedFileName ? `ØªÙ… ØªØ­Ù…ÙŠÙ„: ${uploadedFileName}` : 'Ù…Ù„Ù PDF ØªÙ… ØªØ­Ù…ÙŠÙ„Ù‡'}
            </div>
            <div class="pdf-section-content">
                <strong>ğŸ“Š Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…Ù„Ù:</strong><br>
                â€¢ Ø¹Ø¯Ø¯ Ø§Ù„ØµÙØ­Ø§Øª: ${pdfPages.length}<br>
                â€¢ Ø§Ù„Ø­Ø¬Ù… Ø§Ù„ÙƒØ§Ù…Ù„: ${totalSizeKB}KB (ØªÙ… ØªØ­Ù…ÙŠÙ„Ù‡ Ø¨Ø§Ù„ÙƒØ§Ù…Ù„)<br>
                â€¢ Ø§Ù„Ø­Ø§Ù„Ø©: Ø¬Ø§Ù‡Ø² Ù„Ù„Ø§Ø³ØªØ¹Ù„Ø§Ù…<br><br>
                <strong>ğŸ’¡ Ù†ØµØ§Ø¦Ø­ Ù„Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…:</strong><br>
                1. Ø§Ø³Ø£Ù„ Ø¹Ù† Ø£ÙŠ Ù…ÙÙ‡ÙˆÙ… ÙÙŠ Ø§Ù„Ù…Ù„Ù<br>
                2. Ø§Ø·Ù„Ø¨ ØªÙ„Ø®ÙŠØµ Ø£ÙŠ Ù‚Ø³Ù…<br>
                3. Ø§Ø³Ø£Ù„ Ø¹Ù† Ø£Ø³Ø¦Ù„Ø© ÙˆØ£Ø¬ÙˆØ¨Ø© Ù…Ù† Ø§Ù„Ù…Ø­ØªÙˆÙ‰<br>
                4. Ø§Ø·Ù„Ø¨ Ø´Ø±Ø­ Ø£ÙŠ ÙÙ‚Ø±Ø© ØµØ¹Ø¨Ø©
            </div>
        </div>`;
        
        messageDiv.innerHTML = `
            <div class="ai-icon"><i class="fas fa-file-pdf"></i></div>
            <div class="msg ai">
                <i class="fas fa-check-circle" style="color:var(--primary); margin-left:5px;"></i>
                ØªÙ… ØªØ­Ù…ÙŠÙ„ Ù…Ù„Ù PDF Ø¨Ù†Ø¬Ø§Ø­! (${totalSizeKB}KB)
                ${content}
            </div>
        `;
        
        chatBox.appendChild(messageDiv);
        chatBox.scrollTop = chatBox.scrollHeight;
    }
    
    function savePDFToStorage() {
        if (!currentUser || pdfPages.length === 0) return;
        
        try {
            const userPDFs = JSON.parse(localStorage.getItem('glow_user_pdfs') || '{}');
            const pdfId = `pdf_${Date.now()}`;
            
            // Ø­ÙØ¸ Ø§Ù„Ù…Ù„Ø®Øµ ÙÙ‚Ø· (Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ÙƒØ§Ù…Ù„Ø© Ù‚Ø¯ ØªÙƒÙˆÙ† ÙƒØ¨ÙŠØ±Ø© Ø¬Ø¯Ø§Ù‹)
            userPDFs[pdfId] = {
                userId: currentUser.email,
                fileName: uploadedFileName,
                pages: pdfPages.length,
                size: pdfText.length,
                uploadDate: new Date().toISOString(),
                preview: pdfText.substring(0, 2000) // Ø­ÙØ¸ Ù…Ø¹Ø§ÙŠÙ†Ø© Ø£ÙƒØ¨Ø±
            };
            
            localStorage.setItem('glow_user_pdfs', JSON.stringify(userPDFs));
        } catch (e) {
            console.error("Ø®Ø·Ø£ ÙÙŠ Ø­ÙØ¸ PDF:", e);
        }
    }
    
    // --- Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ ---
    async function askAI() {
       // Ø¥Ø®ÙØ§Ø¡ Ø±Ø³Ø§Ù„Ø© Ø§Ù„ØªØ±Ø­ÙŠØ¨ ÙÙˆØ±Ø§Ù‹ Ø¹Ù†Ø¯ Ø¥Ø±Ø³Ø§Ù„ Ø£ÙˆÙ„ Ø±Ø³Ø§Ù„Ø©
    hideWelcomeMessage();

        if (isTyping) {
            stopCurrentTyping();
            return;
        }
        
        const input = document.getElementById('userInput');
        const text = input.value.trim();
        
        if (!text && !selectedImageBase64) return;
        
        // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø§Øª Ø§Ù„Ù…ØªØ¨Ù‚ÙŠØ©
        if (!isAdmin && attempts <= 0) {
            showPlusModal();
            return;
        }
        
        // Ø¥Ø¶Ø§ÙØ© Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
        addMessage(text || "ØªØ­Ù„ÙŠÙ„ ØµÙˆØ±Ø©...", "user", false, selectedImageBase64);
        
        // Ø¥Ø¹Ø¯Ø§Ø¯ Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø±Ø³Ø§Ù„Ø©
        let messageContent;
        if (selectedImageBase64) {
            messageContent = [
                { type: "text", text: text || "Ù…Ø§Ø°Ø§ ÙŠÙˆØ¬Ø¯ ÙÙŠ Ù‡Ø°Ù‡ Ø§Ù„ØµÙˆØ±Ø©ØŸ" },
                { type: "image_url", image_url: { url: `data:image/jpeg;base64,${selectedImageBase64}` } }
            ];
        } else {
            messageContent = text;
        }
        
        chatHistory.push({ role: "user", content: messageContent });
        
        // ØªÙ†Ø¸ÙŠÙ ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„
        cancelImage();
        input.value = "";
        input.style.height = 'auto';
        
        // Ø¥Ø¸Ù‡Ø§Ø± Ù…Ø¤Ø´Ø± Ø§Ù„ÙƒØªØ§Ø¨Ø©
        const chatBox = document.getElementById('chat-box');
        const typingDiv = document.createElement('div');
        typingDiv.className = 'msg-wrapper ai-wrapper';
        typingDiv.innerHTML = `
            <div class="ai-icon"><i class="fas fa-user-graduate"></i></div>
            <div class="msg ai">
                <div class="loading-dots">
                    <div class="loading-dot"></div>
                    <div class="loading-dot"></div>
                    <div class="loading-dot"></div>
                </div>
            </div>
        `;
        chatBox.appendChild(typingDiv);
        chatBox.scrollTop = chatBox.scrollHeight;
        
        try {
            // Ø¨Ù†Ø§Ø¡ Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ù†Ø¸Ø§Ù… Ù…Ø¹ ØªØ¶Ù…ÙŠÙ† Ù…Ø­ØªÙˆÙ‰ PDF Ø¥Ø°Ø§ ÙƒØ§Ù† Ù…ÙˆØ¬ÙˆØ¯Ø§Ù‹
            let systemPrompt = "Ø£Ù†Øª Glow Ø§Ù„ØªØ¹Ù„ÙŠÙ…ÙŠØŒ Ù…Ø³Ø§Ø¹Ø¯ Ø°ÙƒÙŠ Ù„Ù„Ø·Ù„Ø§Ø¨. Ù…Ù‡Ù…ØªÙƒ Ù…Ø³Ø§Ø¹Ø¯Ø© Ø§Ù„Ø·Ù„Ø§Ø¨ ÙÙŠ ÙÙ‡Ù… Ø§Ù„Ù…ÙˆØ§Ø¯ Ø§Ù„ØªØ¹Ù„ÙŠÙ…ÙŠØ© ÙˆØ§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø¹Ù„Ù‰ Ø£Ø³Ø¦Ù„ØªÙ‡Ù… Ø¨Ø¯Ù‚Ø©. ØªØ·ÙˆÙŠØ±: Ù…. Ø£Ø­Ù…Ø¯ Ø§Ù„Ø£Ø³Ø·Ù„.";
            
            // Ø¥Ø°Ø§ ÙƒØ§Ù† Ù‡Ù†Ø§Ùƒ Ù…Ù„Ù PDF Ù…Ø­Ù…Ù‘Ù„ØŒ Ø¥Ø¶Ø§ÙØ© Ù…Ø­ØªÙˆØ§Ù‡ Ø¥Ù„Ù‰ Ø§Ù„Ø±Ø³Ø§Ù„Ø©
            if (pdfPages.length > 0) {
                systemPrompt += "\n\n**Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ù…Ù„Ù Ø§Ù„ØªØ¹Ù„ÙŠÙ…ÙŠ Ø§Ù„Ù…Ø­Ù…Ù‘Ù„:**\n";
                
                // Ø¥Ø¶Ø§ÙØ© Ù…Ø­ØªÙˆÙ‰ PDF ÙƒØ§Ù…Ù„Ø§Ù‹
                const MAX_PDF_CONTEXT = 40000; // 40K Ø­Ø±Ù ÙƒØ­Ø¯ Ø¢Ù…Ù†
                let pdfContext = "";
                
                // Ø¥Ø¶Ø§ÙØ© Ù…Ø­ØªÙˆÙ‰ Ù…Ù† Ø¬Ù…ÙŠØ¹ Ø§Ù„ØµÙØ­Ø§Øª
                for (const page of pdfPages) {
                    pdfContext += `\n--- Ø§Ù„ØµÙØ­Ø© ${page.page} ---\n${page.text}\n`;
                }
                
                if (pdfContext.length > MAX_PDF_CONTEXT) {
                    // Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ù…Ø­ØªÙˆÙ‰ ÙƒØ¨ÙŠØ± Ø¬Ø¯Ø§Ù‹ØŒ Ù†Ø£Ø®Ø° Ø¹ÙŠÙ†Ø§Øª Ù…Ù† Ø¬Ù…ÙŠØ¹ Ø£Ù†Ø­Ø§Ø¡ Ø§Ù„Ù…Ù„Ù
                    const sampleSize = Math.floor(MAX_PDF_CONTEXT / 3);
                    const start = pdfContext.substring(0, sampleSize);
                    const middle = pdfContext.substring(pdfContext.length / 2 - sampleSize / 2, pdfContext.length / 2 + sampleSize / 2);
                    const end = pdfContext.substring(pdfContext.length - sampleSize);
                    pdfContext = start + "\n\n... [Ù…Ø­ØªÙˆÙ‰ ÙˆØ³Ø·ÙŠ] ...\n\n" + middle + "\n\n... [Ù…Ø­ØªÙˆÙ‰ Ù†Ù‡Ø§Ø¦ÙŠ] ...\n\n" + end;
                }
                
                systemPrompt += pdfContext;
                systemPrompt += "\n\n**ØªØ¹Ù„ÙŠÙ…Ø§Øª Ù…Ù‡Ù…Ø©:** ÙŠØ¬Ø¨ Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø¹Ù„Ù‰ Ø£Ø³Ø¦Ù„Ø© Ø§Ù„Ø·Ø§Ù„Ø¨ Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ù…Ù„Ù Ø§Ù„ØªØ¹Ù„ÙŠÙ…ÙŠ Ø£Ø¹Ù„Ø§Ù‡. Ø¥Ø°Ø§ Ù„Ù… ØªÙƒÙ† Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ù…ÙˆØ¬ÙˆØ¯Ø© ÙÙŠ Ø§Ù„Ù…Ù„ÙØŒ ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ø³ØªØ®Ø¯Ø§Ù… Ù…Ø¹Ø±ÙØªÙƒ Ø§Ù„Ø¹Ø§Ù…Ø© Ø£Ùˆ Ø§Ù„Ø¨Ø­Ø« Ø¹Ù„Ù‰ Ø§Ù„ÙˆÙŠØ¨ (Ø¥Ø°Ø§ ÙƒØ§Ù† Ù…ÙØ¹Ù„Ø§Ù‹).";
            }
            
            if (isWebSearch) {
                systemPrompt += "\n\n**Ù…Ù„Ø§Ø­Ø¸Ø©:** Web Search Ù…ÙØ¹Ù„. Ù‚Ù… Ø¨Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø© ÙˆØ§Ø°ÙƒØ± Ø§Ù„Ù…ØµØ§Ø¯Ø± Ø¨ÙˆØ¶ÙˆØ­.";
            }
            
            // Ø¥Ø¹Ø¯Ø§Ø¯ Ø·Ù„Ø¨ API
            const messages = [
                { role: "system", content: systemPrompt },
                ...chatHistory.slice(-8) // Ø§Ù„Ø­ÙØ§Ø¸ Ø¹Ù„Ù‰ Ø³ÙŠØ§Ù‚ Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø©
            ];
            
            const response = await fetch("https://openrouter.ai/api/v1/chat/completions", {
                method: "POST",
                headers: {
                    "Authorization": `Bearer ${API_KEY}`,
                    "Content-Type": "application/json"
                },
                body: JSON.stringify({
                    model: "google/gemini-2.0-flash-001",
                    messages: messages,
                    max_tokens: 2500
                })
            });
            
            const data = await response.json();
            
            // Ø¥Ø²Ø§Ù„Ø© Ù…Ø¤Ø´Ø± Ø§Ù„ÙƒØªØ§Ø¨Ø©
            if (typingDiv.parentNode) {
                chatBox.removeChild(typingDiv);
            }
            
            if (data.choices && data.choices[0]) {
                const aiResponse = data.choices[0].message.content;
                
                // Ø¨Ø¯Ø¡ ØªØ£Ø«ÙŠØ± Ø§Ù„ÙƒØªØ§Ø¨Ø©
                setStopState(true);
                addMessage(aiResponse, "ai", true);
                
                // ØªØ­Ø¯ÙŠØ« Ø³Ø¬Ù„ Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø©
                chatHistory.push({ role: "assistant", content: aiResponse });
                
                // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø§Øª Ø§Ù„Ù…ØªØ¨Ù‚ÙŠØ©
                if (!isAdmin) {
                    attempts--;
                    localStorage.setItem('Glow_usage_' + deviceId, attempts);
                    
                    // Ø¥Ø°Ø§ ÙƒØ§Ù† Ù…Ø³ØªØ®Ø¯Ù… Ù…Ø³Ø¬Ù„ØŒ ØªØ­Ø¯ÙŠØ« Ù…Ø­Ø§ÙˆÙ„Ø§ØªÙ‡
                    if (currentUser) {
                        const users = JSON.parse(localStorage.getItem('glow_users') || '{}');
                        if (users[currentUser.email]) {
                            users[currentUser.email].attempts = attempts;
                            localStorage.setItem('glow_users', JSON.stringify(users));
                        }
                    }
                }
                
                syncUI();
                saveChat();
                
            } else {
                throw new Error("Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¥Ø¬Ø§Ø¨Ø© Ù…Ù† Ø§Ù„Ø®Ø§Ø¯Ù…");
            }
            
        } catch (error) {
            console.error("Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„:", error);
            
            // Ø¥Ø²Ø§Ù„Ø© Ù…Ø¤Ø´Ø± Ø§Ù„ÙƒØªØ§Ø¨Ø©
            if (typingDiv.parentNode) {
                chatBox.removeChild(typingDiv);
            }
            
            addMessage("Ø¹Ø°Ø±Ø§Ù‹ØŒ Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„. ÙŠØ±Ø¬Ù‰ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.", "ai", false);
        }
    }
    
    // --- ÙˆØ¸Ø§Ø¦Ù Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ ---
    function addMessage(text, side, animate, img = null) {
        const chatBox = document.getElementById('chat-box');
        const wrapper = document.createElement('div');
        wrapper.className = `msg-wrapper ${side}-wrapper`;
        
        if (side === 'ai') {
            wrapper.innerHTML = `
                <div class="ai-icon"><i class="fas fa-user-graduate"></i></div>
                <div class="msg ai"></div>
            `;
        } else {
            wrapper.innerHTML = `<div class="msg user"></div>`;
        }
        
        const msgDiv = wrapper.querySelector('.msg');
        
        // Ø¥Ø°Ø§ ÙƒØ§Ù† Ù‡Ù†Ø§Ùƒ ØµÙˆØ±Ø©
        if (img) {
            msgDiv.innerHTML += `<img src="data:image/jpeg;base64,${img}" style="max-width:100%; border-radius:12px; margin-bottom:15px; display:block;"><br>`;
        }
        
        chatBox.appendChild(wrapper);
        
        // ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ù†Øµ Ø¥Ø°Ø§ ÙƒØ§Ù† Ù…ØµÙÙˆÙØ©
        const displayText = Array.isArray(text) ? 
            text.find(t => t.type === 'text')?.text || "ØªØ­Ù„ÙŠÙ„ ÙˆØ³Ø§Ø¦Ø·..." : 
            text;
        
        // ØªØ£Ø«ÙŠØ± Ø§Ù„ÙƒØªØ§Ø¨Ø© Ø¥Ø°Ø§ ÙƒØ§Ù† Ù…Ø·Ù„ÙˆØ¨Ø§Ù‹
        if (side === 'ai' && animate) {
            let index = 0;
            msgDiv.innerText = "";
            
            typingInterval = setInterval(() => {
                if (index < displayText.length) {
                    msgDiv.innerText += displayText[index];
                    index++;
                    chatBox.scrollTop = chatBox.scrollHeight;
                } else {
                    stopCurrentTyping();
                    processSources(msgDiv);
                }
            }, window.innerWidth <= 767 ? 3 : 5); // Ø³Ø±Ø¹Ø© ÙƒØªØ§Ø¨Ø© Ù…ØªØºÙŠØ±Ø© Ø­Ø³Ø¨ Ø§Ù„Ø¬Ù‡Ø§Ø²
        
        } else {
            msgDiv.innerText = displayText;
            if (side === 'ai') {
                processSources(msgDiv);
            }
        }
        
        chatBox.scrollTop = chatBox.scrollHeight;
    }
    
    function setStopState(active) {
        isTyping = active;
        const btn = document.getElementById('sendBtn');
        const icon = document.getElementById('sendIcon');
        
        if (active) {
            btn.classList.add('stop');
            btn.style.background = 'var(--error)';
            icon.className = 'fas fa-stop';
        } else {
            btn.classList.remove('stop');
            btn.style.background = 'var(--gradient-primary)';
            icon.className = 'fas fa-paper-plane';
        }
    }
    
    function stopCurrentTyping() {
        if (typingInterval) {
            clearInterval(typingInterval);
            typingInterval = null;
        }
        setStopState(false);
    }
    
    function processSources(container) {
        // Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø±ÙˆØ§Ø¨Ø· ÙÙŠ Ø§Ù„Ù†Øµ
        const regex = /https?:\/\/[^\s]+|www\.[^\s]+/g;
        const text = container.innerText;
        const links = text.match(regex);
        
        if (links) {
            let newHTML = container.innerHTML;
            
            links.forEach(link => {
                try {
                    const fullLink = link.startsWith('http') ? link : 'https://' + link;
                    const domain = new URL(fullLink).hostname;
                    
                    const sourceCard = `<br><a href="${fullLink}" target="_blank" class="source-card">
                        <img src="https://www.google.com/s2/favicons?sz=64&domain=${domain}">
                        Ø§Ù„Ù…ØµØ¯Ø±: ${domain}
                    </a>`;
                    
                    newHTML = newHTML.replace(link, sourceCard);
                } catch (e) {
                    // ØªØ¬Ø§Ù‡Ù„ Ø§Ù„Ø±ÙˆØ§Ø¨Ø· ØºÙŠØ± Ø§Ù„ØµØ§Ù„Ø­Ø©
                }
            });
            
            container.innerHTML = newHTML;
        }
    }
    
    // --- Ø§Ù„Ù…ÙˆØ¯Ø§Ù„Ø§Øª ---
    function showPlusModal() {
        document.getElementById('plusModal').style.display = 'flex';
        closeUserDropdown();
    }
    
    function closeModal(modalId) {
        document.getElementById(modalId).style.display = 'none';
    }
    
    // --- Ø­ÙØ¸ Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø§Øª ---
    function saveChat() {
        if (!currentChatId) return;
        
        try {
            const chats = JSON.parse(localStorage.getItem('glow_chats') || '{}');
            const firstMessage = chatHistory[0]?.content;
            
            let title = "Ù…Ø­Ø§Ø¯Ø«Ø© Ø¬Ø¯ÙŠØ¯Ø©";
            if (firstMessage) {
                if (Array.isArray(firstMessage)) {
                    title = firstMessage[0]?.text || title;
                } else {
                    title = firstMessage.substring(0, 30);
                }
            }
            
            // Ø­ÙØ¸ Ø§Ù„Ù…Ù„Ø®Øµ ÙÙ‚Ø· (Ù„ØªÙØ§Ø¯ÙŠ ØªØ®Ø²ÙŠÙ† ÙƒØ¨ÙŠØ±)
            chats[currentChatId] = {
                title: title,
                userId: currentUser?.email || 'guest',
                messageCount: chatHistory.length,
                lastUpdate: new Date().toISOString(),
                hasPDF: pdfPages.length > 0
            };
            
            localStorage.setItem('glow_chats', JSON.stringify(chats));
            loadHistory();
            
        } catch (e) {
            console.error("Ø®Ø·Ø£ ÙÙŠ Ø­ÙØ¸ Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø©:", e);
        }
    }
    
    function loadHistory() {
        const chats = JSON.parse(localStorage.getItem('glow_chats') || '{}');
        const list = document.getElementById('history-list');
        list.innerHTML = "";
        
        const chatEntries = Object.entries(chats);
        
        if (chatEntries.length === 0) {
            list.innerHTML = '<div style="text-align:center; color:#666; padding:20px;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø­Ø§Ø¯Ø«Ø§Øª Ø³Ø§Ø¨Ù‚Ø©</div>';
            return;
        }
        
        // Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø§Øª Ø¨ØªØ±ØªÙŠØ¨ Ø²Ù…Ù†ÙŠ Ø¹ÙƒØ³ÙŠ
        chatEntries
            .sort((a, b) => b[1].lastUpdate?.localeCompare(a[1].lastUpdate) || -1)
            .forEach(([id, chat]) => {
                const item = document.createElement('div');
                item.className = "history-item";
                if (id === currentChatId.toString()) {
                    item.classList.add('active');
                }
                
                let title = chat.title || "Ù…Ø­Ø§Ø¯Ø«Ø© Ø¨Ø¯ÙˆÙ† Ø¹Ù†ÙˆØ§Ù†";
                if (chat.hasPDF) {
                    title = "ğŸ“„ " + title;
                }
                
                item.innerText = title;
                item.onclick = () => {
                    // Ù‡Ù†Ø§ ÙŠÙ…ÙƒÙ† ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø© Ø§Ù„ÙƒØ§Ù…Ù„Ø© Ù…Ù† ØªØ®Ø²ÙŠÙ† Ù…Ù†ÙØµÙ„
                    // ÙÙŠ Ù‡Ø°Ø§ Ø§Ù„Ù…Ø«Ø§Ù„ØŒ Ù†Ø¨Ø¯Ø£ Ù…Ø­Ø§Ø¯Ø«Ø© Ø¬Ø¯ÙŠØ¯Ø© ÙÙ‚Ø·
                    startNewChat();
                    toggleSidebar();
                };
                
                list.appendChild(item);
            });
    }
    
    // Ø§Ø®ØªØµØ§Ø±Ø§Øª Ù„ÙˆØ­Ø© Ø§Ù„Ù…ÙØ§ØªÙŠØ­
    document.addEventListener('keydown', (e) => {
        if (e.key === 'Enter' && !e.shiftKey) {
            e.preventDefault();
            askAI();
        }
        
        if (e.key === 'Escape') {
            stopCurrentTyping();
            toggleSidebar();
            closeUserDropdown();
        }
    });
    
    // --- Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…Ø·ÙˆØ± ---
    // Ù‡Ø°Ø§ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ ØªÙ… ØªØ·ÙˆÙŠØ±Ù‡ Ø¨ÙˆØ§Ø³Ø·Ø© Ù…. Ø£Ø­Ù…Ø¯ Ø§Ù„Ø£Ø³Ø·Ù„
    // Ø§Ù„ØªØ³Ø¬ÙŠÙ„ Ø¹Ù„Ù‰ Google Play ÙˆØªØ®ØµÙŠØµ Ù…Ø³Ø§Ø­Ø© Ø§Ù„ØªØ®Ø²ÙŠÙ† ØªØªÙ… Ù…Ù† Ø®Ù„Ø§Ù„ ÙˆØ­Ø¯Ø© ØªØ­ÙƒÙ… Ù…Ø·ÙˆØ±ÙŠ Google
    // Ù„Ù„Ù…Ø²ÙŠØ¯ Ù…Ù† Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª: https://developers.google.com/identity
    
    // --- Ø§Ø³ØªØ¬Ø§Ø¨Ø© Ù„Ù„Ø´Ø§Ø´Ø§Øª Ø§Ù„Ù…Ø®ØªÙ„ÙØ© ---
    function checkScreenSize() {
        // Ù‡Ø°Ù‡ Ø§Ù„ÙˆØ¸ÙŠÙØ© ÙŠÙ…ÙƒÙ† Ø§Ø³ØªØ®Ø¯Ø§Ù…Ù‡Ø§ Ù„Ø¥Ø¬Ø±Ø§Ø¡ ØªØ¹Ø¯ÙŠÙ„Ø§Øª Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠØ© Ø­Ø³Ø¨ Ø­Ø¬Ù… Ø§Ù„Ø´Ø§Ø´Ø©
        const isMobile = window.innerWidth <= 767;
        
        // ÙŠÙ…ÙƒÙ†Ùƒ Ø¥Ø¶Ø§ÙØ© ØªØ¹Ø¯ÙŠÙ„Ø§Øª Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠØ© Ù‡Ù†Ø§ Ø¥Ø°Ø§ Ù„Ø²Ù… Ø§Ù„Ø£Ù…Ø±
        if (isMobile) {
            // Ø¥Ø¶Ø§ÙØ© ØªØ­Ø³ÙŠÙ†Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ© Ù„Ù„Ø¬ÙˆØ§Ù„
        }
    }
    
    // Ø§Ø³ØªØ¯Ø¹Ø§Ø¡ Ø¹Ù†Ø¯ ØªØºÙŠÙŠØ± Ø­Ø¬Ù… Ø§Ù„Ù†Ø§ÙØ°Ø©
    window.addEventListener('resize', checkScreenSize);
    checkScreenSize(); // Ø§Ø³ØªØ¯Ø¹Ø§Ø¡ Ø£ÙˆÙ„ÙŠ
    
</script>
</body>
</html>